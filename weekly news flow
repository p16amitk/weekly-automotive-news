name: Weekly Automotive News Report
on:
  schedule:
    - cron: '30 3 * * 1'   # every Monday at 03:30 UTC -> 09:00 IST
  workflow_dispatch: {}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install feedparser pandas python-dateutil requests
      - name: Date check (stop after Oct 31, 2025)
        run: |
          python - <<'PY'
          from datetime import date
          if date.today() > date(2025,10,31):
              print('Past end date (2025-10-31). Exiting without sending report.')
              raise SystemExit(0)
          print('Within date range â€” proceeding')
          PY
      - name: Run report script
        env:
          SMTP_HOST: ${{ secrets.SMTP_HOST }}
          SMTP_PORT: ${{ secrets.SMTP_PORT }}
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PASS: ${{ secrets.SMTP_PASS }}
          TO_EMAIL: ${{ secrets.TO_EMAIL }}
          EMAIL_SUBJECT: ${{ secrets.EMAIL_SUBJECT }}
        run: |
          python weekly_automotive_news_report.py --output report
